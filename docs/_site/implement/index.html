<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Implement | ethGlobalBrussels</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Implement" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="How to implement Scaffold-eth2 using Chronicle’s Scribe Oracle" />
<meta property="og:description" content="How to implement Scaffold-eth2 using Chronicle’s Scribe Oracle" />
<link rel="canonical" href="http://localhost:4000/ethGlobalBrussels/implement/" />
<meta property="og:url" content="http://localhost:4000/ethGlobalBrussels/implement/" />
<meta property="og:site_name" content="ethGlobalBrussels" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Implement" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"How to implement Scaffold-eth2 using Chronicle’s Scribe Oracle","headline":"Implement","url":"http://localhost:4000/ethGlobalBrussels/implement/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/ethGlobalBrussels/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/ethGlobalBrussels/feed.xml" title="ethGlobalBrussels" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/ethGlobalBrussels/">ethGlobalBrussels</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/ethGlobalBrussels/get_started/">Get Started</a><a class="page-link" href="/ethGlobalBrussels/implement/">Implement</a><a class="page-link" href="/ethGlobalBrussels/">Home</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Implement</h1>
  </header>

  <div class="post-content">
    <h3 id="creating-a-diamond-hands-contract-using-chronicle-oracle">Creating a “Diamond Hands” Contract using Chronicle Oracle</h3>
<p>Now that we have a <a href="/ethGlobalBrussels/get_started">working scaffold-eth2 framework</a> connected to the Chronicle Scribe Oracle on Sepolia, we can build a contract that will actually use the information provided to us by the Oracle!</p>

<p>Our smart contract will have a simple function: A user can deposit funds into the contract and declare a price in USD which they believe (or want) Eth to reach. The deposited funds will stay locked in the smart contract unless the Chronicle ETH_USD oracle reports that the price of Eth is above the set minimum. If the Chronicle price exceeds the minimum set by the user, they’ll be able to withdraw. If not, they’ll need to keep holding with their diamond hands (and the help of this smart contract).
<br />
<br /></p>

<hr />

<h4 id="variables">Variables</h4>

<p>We need a way to track the minimum price and the real Chronicle-reported price.</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">uint256</span> <span class="k">public</span> <span class="n">minimumPrice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">uint256</span> <span class="k">public</span> <span class="n">chroniclePrice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="functions">Functions</h4>
<p>In order to get the real price of Eth into the smart contract, we need to use Chronicle’s Oracle. Here’s an example that <strong>reads the value</strong> and also stores it as a variable. <em>Note: since this function makes an edit to the state instead of just reading, it will cost gas.</em></p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// sets the chroniclePrice variable to the read value, then returns it
</span><span class="k">function</span> <span class="n">getChroniclePrice</span><span class="p">()</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">chroniclePrice</span> <span class="o">=</span> <span class="n">chronicle</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">chroniclePrice</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We need a way for the user to <strong>deposit funds</strong> into the contract and also <strong>set the minimumPrice</strong>. We’ll repurpose the Scaffold-Eth default function setGreeting and event greetingSetter to use our variable of minimumPrice instead:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">event</span> <span class="n">minimumPriceChange</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">priceSetter</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">newMinimumPrice</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">value</span>
  <span class="p">);</span>

  <span class="k">function</span> <span class="n">setMinimumPrice</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_newMinimumPrice</span><span class="p">)</span> <span class="k">public</span> <span class="k">payable</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span>
      <span class="n">_newMinimumPrice</span> <span class="o">&gt;</span> <span class="n">minimumPrice</span><span class="p">,</span>
      <span class="s">"New minimum must be an increase from the current minimum"</span>
    <span class="p">);</span>
    <span class="n">console</span><span class="p">.</span><span class="n">logString</span><span class="p">(</span><span class="s">"Setting new minimum price"</span><span class="p">);</span>
    <span class="n">console</span><span class="p">.</span><span class="n">logString</span><span class="p">(</span><span class="n">Strings</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">_newMinimumPrice</span><span class="p">))</span>
    <span class="n">minimumPrice</span> <span class="o">=</span> <span class="n">_newMinimumPrice</span><span class="p">;</span>

    <span class="k">emit</span> <span class="n">minimumPriceChange</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_newMinimumPrice</span><span class="p">,</span> <span class="n">msg</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Finally, we need a <strong>withdraw function</strong> which checks whether the Chronicle Oracle price has exceeded the minimum, and transfer the funds if so.</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="k">public</span> <span class="n">onlyOwner</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="nb">balance</span> <span class="o">=</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">).</span><span class="nb">balance</span><span class="p">;</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">balance</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"No ether available to withdraw"</span><span class="p">);</span>
    <span class="n">chroniclePrice</span> <span class="o">=</span> <span class="n">chronicle</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
    <span class="nb">require</span><span class="p">(</span>
      <span class="n">chroniclePrice</span> <span class="o">&gt;=</span> <span class="n">minimumPrice</span><span class="p">,</span>
      <span class="s">"Chronicle price is less than the minimum price! Keep holding!"</span>
    <span class="p">);</span>
    <span class="k">payable</span><span class="p">(</span><span class="n">owner</span><span class="p">()).</span><span class="nb">transfer</span><span class="p">(</span><span class="nb">balance</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>Hopefully these functions are enough to get you started on building our Diamond Hands holding smart contract powered by Chronicle’s Scribe Oracle. If you’d like to see a full code example using the above functions, <a href="https://github.com/hehozo/DiamondHands">you can find it here.</a></p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/ethGlobalBrussels/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">ethGlobalBrussels</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">ethGlobalBrussels</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>How to implement Scaffold-eth2 using Chronicle&#39;s Scribe Oracle</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
